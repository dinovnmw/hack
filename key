-- [[ DINO SYSTEM PVP - REBORN VERSION ]] --
if not game:IsLoaded() then game.Loaded:Wait() end

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")
local RbxAnalyticsService = game:GetService("RbxAnalyticsService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local API_URL = "https://dinokey.x10.mx/key.php?api=verify"
local MAIN_URL = "https://raw.githubusercontent.com/dinovnmw/hack/refs/heads/main/loader"
local CACHE_FILE = "dino_key_cache.json"

-- ================= UTILS =================
local function createTween(obj, time, goal)
    local info = TweenInfo.new(time, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
    local tween = TweenService:Create(obj, info, goal)
    tween:Play()
    return tween
end

-- Hàm kéo thả (Drag System)
local function makeDraggable(frame)
    local dragging, dragInput, dragStart, startPos
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true; dragStart = input.Position; startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- ================= UI DESIGN =================
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "DinoKeyUI_V3"

local blur = Instance.new("BlurEffect", Lighting)
blur.Size = 0
createTween(blur, 0.5, {Size = 15})

local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.fromOffset(350, 250)
mainFrame.Position = UDim2.fromScale(0.5, 0.5)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(12, 12, 15)
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
makeDraggable(mainFrame)

local corner = Instance.new("UICorner", mainFrame)
corner.CornerRadius = UDim.new(0, 12)

local stroke = Instance.new("UIStroke", mainFrame)
stroke.Color = Color3.fromRGB(60, 60, 80)
stroke.Thickness = 1.2
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

-- Header Decor
local header = Instance.new("Frame", mainFrame)
header.Size = UDim2.new(1, 0, 0, 40)
header.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(1, 0, 1, 0)
title.BackgroundTransparency = 1
title.Text = "DINO SYSTEM PVP"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Status Label
local status = Instance.new("TextLabel", mainFrame)
status.Size = UDim2.new(1, 0, 0, 20)
status.Position = UDim2.new(0, 0, 0.2, 5)
status.BackgroundTransparency = 1
status.Text = "Waiting for input..."
status.Font = Enum.Font.GothamMedium
status.TextSize = 12
status.TextColor3 = Color3.fromRGB(180, 180, 200)

-- Input Box
local box = Instance.new("TextBox", mainFrame)
box.Size = UDim2.new(0.85, 0, 0, 45)
box.Position = UDim2.new(0.075, 0, 0.4, 0)
box.PlaceholderText = "Paste License Key Here"
box.Font = Enum.Font.Gotham
box.TextSize = 14
box.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
box.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", box).CornerRadius = UDim.new(0, 8)
Instance.new("UIStroke", box).Color = Color3.fromRGB(45, 45, 65)

-- Buttons Container
local btnVerify = Instance.new("TextButton", mainFrame)
btnVerify.Size = UDim2.new(0.85, 0, 0, 45)
btnVerify.Position = UDim2.new(0.075, 0, 0.65, 0)
btnVerify.Text = "VERIFY ACCESS"
btnVerify.Font = Enum.Font.GothamBold
btnVerify.TextSize = 14
btnVerify.BackgroundColor3 = Color3.fromRGB(40, 110, 255)
btnVerify.TextColor3 = Color3.new(1, 1, 1)
btnVerify.AutoButtonColor = false
Instance.new("UICorner", btnVerify).CornerRadius = UDim.new(0, 8)

local btnGetKey = Instance.new("TextButton", mainFrame)
btnGetKey.Size = UDim2.new(0.85, 0, 0, 25)
btnGetKey.Position = UDim2.new(0.075, 0, 0.86, 0)
btnGetKey.BackgroundTransparency = 1
btnGetKey.Text = "Don't have a key? Click here"
btnGetKey.Font = Enum.Font.Gotham
btnGetKey.TextSize = 11
btnGetKey.TextColor3 = Color3.fromRGB(120, 120, 150)

-- Animation Entry
mainFrame.Size = UDim2.fromOffset(0, 0)
createTween(mainFrame, 0.6, {Size = UDim2.fromOffset(350, 250)})

-- ================= LOGIC =================
local function getHWID()
    return RbxAnalyticsService:GetClientId()
end

local function notify(txt, color)
    status.Text = txt
    status.TextColor3 = color or Color3.fromRGB(200, 200, 200)
end

local function verifyKey(key)
    local success, result = pcall(function()
        local url = API_URL .. "&key=" .. HttpService:UrlEncode(key) .. "&hwid=" .. HttpService:UrlEncode(getHWID())
        return game:HttpGet(url)
    end)
    if success then
        return HttpService:JSONDecode(result)
    end
    return {status = "error", message = "Connection Failed"}
end

local function loadMain()
    notify("Authentication Successful!", Color3.fromRGB(100, 255, 100))
    task.wait(0.5)
    createTween(mainFrame, 0.5, {Size = UDim2.fromOffset(0, 0), BackgroundTransparency = 1})
    createTween(blur, 0.5, {Size = 0})
    task.wait(0.5)
    gui:Destroy()
    blur:Destroy()
    
    local success, err = pcall(function()
        loadstring(game:HttpGet(MAIN_URL))()
    end)
    if not success then
        warn("Dino System Error: " .. tostring(err))
    end
end

-- Event: Get Key
btnGetKey.MouseButton1Click:Connect(function()
    setclipboard("https://dinokey.x10.mx") -- Thay link get key của bạn vào đây
    notify("Key link copied to clipboard!", Color3.fromRGB(200, 200, 100))
end)

-- Event: Verify
btnVerify.MouseButton1Click:Connect(function()
    local key = box.Text:gsub("%s+", "")
    if key == "" then 
        notify("Please enter a key!", Color3.fromRGB(255, 100, 100))
        return 
    end

    btnVerify.Active = false
    btnVerify.Text = "Checking..."
    createTween(btnVerify, 0.2, {BackgroundColor3 = Color3.fromRGB(30, 30, 40)})

    local res = verifyKey(key)

    if res and res.status == "success" then
        if writefile then
            writefile(CACHE_FILE, HttpService:JSONEncode({key = key, time = os.time()}))
        end
        loadMain()
    else
        notify(res and res.message or "Invalid License Key", Color3.fromRGB(255, 100, 100))
        btnVerify.Text = "VERIFY ACCESS"
        btnVerify.Active = true
        createTween(btnVerify, 0.2, {BackgroundColor3 = Color3.fromRGB(40, 110, 255)})
    end
end)

-- Auto Login Logic
task.spawn(function()
    if isfile and isfile(CACHE_FILE) then
        local success, cacheData = pcall(function()
            return HttpService:JSONDecode(readfile(CACHE_FILE))
        end)
        
        if success and cacheData.key then
            notify("Resuming last session...", Color3.fromRGB(150, 150, 255))
            local res = verifyKey(cacheData.key)
            if res and res.status == "success" then
                loadMain()
                return
            end
        end
    end
    notify("Welcome, " .. player.Name, Color3.fromRGB(255, 255, 255))
end)

-- Button Hover Effects
btnVerify.MouseEnter:Connect(function()
    createTween(btnVerify, 0.2, {BackgroundColor3 = Color3.fromRGB(60, 130, 255)})
end)
btnVerify.MouseLeave:Connect(function()
    createTween(btnVerify, 0.2, {BackgroundColor3 = Color3.fromRGB(40, 110, 255)})
end)
