--[[ 
    DINO PVP V3 ULTIMATE - SUPER ANTIBAN & DODGE EDITION
    Library: Fluent (Modern, Dark, Smooth)
    Language: Lua
    Target: Roblox Executors (Synapse, Krnl, Fluxus, Delta, Hydrogen, etc.)
]]

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- ================= SERVICES =================
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local VirtualUser = game:GetService("VirtualUser")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

-- ================= VARIABLES =================
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- ================= CONFIGURATION =================
local Config = {
    -- Aimbot
    Aimbot = false,
    AimMode = "Nearest Character",
    SelectedTarget = "",
    AimPart = "Head",
    AimSmooth = 0.1,
    
    -- Combat
    KillAura = false,
    KillAuraRange = 20,
    TriggerBot = false,
    Hitbox = false,
    HitboxSize = 10,
    Spinbot = false,
    SpinSpeed = 50,
    Dodge = false,        -- NEW
    DodgeSpeed = 5,       -- NEW
    DodgePower = 2,       -- NEW
    
    -- Visuals
    ESP = false,
    ESPTeamCheck = true,
    
    -- Movement
    WalkSpeed = 16,
    JumpPower = 50,
    Fly = false,
    FlySpeed = 50,
    Noclip = false,
    InfJump = false,

    -- Security (New)
    AntiKick = false,
    AntiAFK = true,
    AntiDetect = false -- Basic Speed Spoof
}

-- ================= UI SETUP =================
local Window = Fluent:CreateWindow({
    Title = "DinoPVP V3 Ultimate",
    SubTitle = "Antiban & Dodge Added",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.RightControl
})

local Tabs = {
    Aimbot = Window:AddTab({ Title = "Aimbot", Icon = "crosshair" }),
    Combat = Window:AddTab({ Title = "Combat", Icon = "swords" }),
    Visuals = Window:AddTab({ Title = "Visuals", Icon = "eye" }),
    Movement = Window:AddTab({ Title = "Movement", Icon = "move" }),
    Security = Window:AddTab({ Title = "Security", Icon = "shield" }), -- NEW TAB
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- ================= MOBILE UI TOGGLE ICON =================
-- Adds a button to open/close menu on mobile
local function CreateMobileToggle()
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
    if PlayerGui:FindFirstChild("DinoMobileToggle") then return end

    local ToggleGui = Instance.new("ScreenGui")
    ToggleGui.Name = "DinoMobileToggle"
    ToggleGui.IgnoreGuiInset = true
    ToggleGui.ResetOnSpawn = false
    ToggleGui.DisplayOrder = 999999
    ToggleGui.Parent = PlayerGui

    local ToggleBtn = Instance.new("ImageButton")
    ToggleBtn.Name = "ToggleButton"
    ToggleBtn.Parent = ToggleGui
    ToggleBtn.Size = UDim2.fromOffset(50, 50)
    ToggleBtn.Position = UDim2.new(0, 20, 0.4, 0)
    ToggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    ToggleBtn.BackgroundTransparency = 0.2
    ToggleBtn.BorderSizePixel = 0
    ToggleBtn.Image = "rbxassetid://13350795660" -- Fluent Icon
    ToggleBtn.Active = true
    ToggleBtn.Draggable = true

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(1, 0)
    UICorner.Parent = ToggleBtn
    
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(100, 100, 255)
    UIStroke.Thickness = 2
    UIStroke.Parent = ToggleBtn

    ToggleBtn.MouseButton1Click:Connect(function()
        Window:Minimize()
    end)
end
CreateMobileToggle()

-- ================= HELPER FUNCTIONS =================

local function IsValidEnemy(plr)
    if not plr or plr == LocalPlayer or not plr.Character then return false end
    local hum = plr.Character:FindFirstChild("Humanoid")
    local root = plr.Character:FindFirstChild("HumanoidRootPart")
    
    if not hum or not root or hum.Health <= 0 then return false end
    
    if Config.ESPTeamCheck and plr.Team and LocalPlayer.Team and plr.Team == LocalPlayer.Team then
        return false
    end
    
    if plr.Character:FindFirstChild("ForceField") then return false end
    
    return true
end

local function GetClosestPlayerToChar()
    local closestPlr = nil
    local shortestDist = math.huge
    local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    
    if not myRoot then return nil end

    for _, v in pairs(Players:GetPlayers()) do
        if IsValidEnemy(v) then
            local dist = (myRoot.Position - v.Character.HumanoidRootPart.Position).Magnitude
            if dist < shortestDist then
                closestPlr = v
                shortestDist = dist
            end
        end
    end
    return closestPlr
end

local function GetPlayerNames()
    local names = {}
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer then table.insert(names, v.Name) end
    end
    return names
end

local function AttackClick()
    -- Simulates a left mouse click
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 1)
    task.wait(0.01)
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 1)
end

-- ================= UI ELEMENTS =================

-- [[ AIMBOT TAB ]]
local AimGroup = Tabs.Aimbot:AddSection("Targeting System")

AimGroup:AddToggle("AimbotToggle", {Title = "Enable Aimbot", Default = false, Callback = function(v) Config.Aimbot = v end})

AimGroup:AddDropdown("AimMode", {
    Title = "Aim Mode",
    Values = {"Nearest Character", "Specific Player"},
    Multi = false,
    Default = "Nearest Character",
    Callback = function(v) Config.AimMode = v end
})

local PlayerDropdown = AimGroup:AddDropdown("SelectPlayer", {
    Title = "Select Specific Player",
    Values = GetPlayerNames(),
    Multi = false,
    Default = 1,
    Callback = function(v) Config.SelectedTarget = v end
})

AimGroup:AddButton({
    Title = "Refresh Player List",
    Description = "Update dropdown with current players",
    Callback = function()
        PlayerDropdown:SetValues(GetPlayerNames())
        PlayerDropdown:SetValue(nil)
    end
})

AimGroup:AddDropdown("AimPart", {
    Title = "Aim Part",
    Values = {"Head", "HumanoidRootPart", "Torso"},
    Default = "Head",
    Multi = false,
    Callback = function(v) Config.AimPart = v end
})

AimGroup:AddSlider("AimSmooth", {
    Title = "Smoothness",
    Description = "0 = Rage, 1 = Legit",
    Min = 0, Max = 1, Default = 0.1, Rounding = 2,
    Callback = function(v) Config.AimSmooth = v end
})

-- [[ COMBAT TAB ]]
local CombatGroup = Tabs.Combat:AddSection("PVP Enhancements")

CombatGroup:AddToggle("KillAura", {Title = "Kill Aura", Description = "Auto attack enemies in range", Default = false, Callback = function(v) Config.KillAura = v end})
CombatGroup:AddSlider("AuraRange", {Title = "Kill Aura Range", Min = 5, Max = 50, Default = 20, Rounding = 0, Callback = function(v) Config.KillAuraRange = v end})
CombatGroup:AddToggle("TriggerBot", {Title = "TriggerBot", Description = "Shoots when aiming at enemy", Default = false, Callback = function(v) Config.TriggerBot = v end})
CombatGroup:AddToggle("Hitbox", {Title = "Hitbox Expander", Default = false, Callback = function(v) Config.Hitbox = v end})
CombatGroup:AddSlider("HitboxSize", {Title = "Hitbox Size", Min = 2, Max = 30, Default = 10, Rounding = 0, Callback = function(v) Config.HitboxSize = v end})
CombatGroup:AddToggle("Spinbot", {Title = "Spinbot (Anti-Aim)", Default = false, Callback = function(v) Config.Spinbot = v end})
CombatGroup:AddSlider("SpinSpeed", {Title = "Spin Speed", Min = 10, Max = 100, Default = 50, Rounding = 0, Callback = function(v) Config.SpinSpeed = v end})

-- New Dodge Section
local DodgeGroup = Tabs.Combat:AddSection("Dodge System")
DodgeGroup:AddToggle("Dodge", {Title = "Enable Dodge (Auto Strafe)", Default = false, Callback = function(v) Config.Dodge = v end})
DodgeGroup:AddSlider("DodgeSpeed", {Title = "Dodge Speed", Min = 1, Max = 20, Default = 5, Rounding = 1, Callback = function(v) Config.DodgeSpeed = v end})
DodgeGroup:AddSlider("DodgePower", {Title = "Dodge Distance", Min = 1, Max = 10, Default = 2, Rounding = 1, Callback = function(v) Config.DodgePower = v end})

-- [[ VISUALS TAB ]]
local VisualsGroup = Tabs.Visuals:AddSection("ESP Settings")
VisualsGroup:AddToggle("ESP", {Title = "Enable ESP (Highlight)", Default = false, Callback = function(v) Config.ESP = v end})
VisualsGroup:AddToggle("ESPTeam", {Title = "Team Check", Default = true, Callback = function(v) Config.ESPTeamCheck = v end})

-- [[ MOVEMENT TAB ]]
local MoveGroup = Tabs.Movement:AddSection("Character")
MoveGroup:AddToggle("Fly", {Title = "Fly Mode", Default = false, Callback = function(v) Config.Fly = v end})
MoveGroup:AddSlider("FlySpeed", {Title = "Fly Speed", Min = 10, Max = 200, Default = 50, Rounding = 0, Callback = function(v) Config.FlySpeed = v end})
MoveGroup:AddSlider("WS", {Title = "WalkSpeed", Min = 16, Max = 300, Default = 16, Rounding = 0, Callback = function(v) Config.WalkSpeed = v end})
MoveGroup:AddSlider("JP", {Title = "JumpPower", Min = 50, Max = 400, Default = 50, Rounding = 0, Callback = function(v) Config.JumpPower = v end})
MoveGroup:AddToggle("Noclip", {Title = "Noclip", Default = false, Callback = function(v) Config.Noclip = v end})
MoveGroup:AddToggle("InfJump", {Title = "Infinite Jump", Default = false, Callback = function(v) Config.InfJump = v end})

-- [[ SECURITY TAB ]]
local SecurityGroup = Tabs.Security:AddSection("Protection Suite")

SecurityGroup:AddToggle("AntiKick", {
    Title = "Anti-Kick (Client)",
    Description = "Prevents client-sided kick attempts (Requires hookmetamethod)",
    Default = false,
    Callback = function(v) 
        Config.AntiKick = v 
        if v then
            Fluent:Notify({Title = "Security", Content = "Anti-Kick Enabled. Local scripts cannot kick you.", Duration = 3})
        end
    end
})

SecurityGroup:AddToggle("AntiAFK", {
    Title = "Anti-AFK",
    Description = "Prevents 20 min idle disconnect",
    Default = true,
    Callback = function(v) Config.AntiAFK = v end
})

SecurityGroup:AddToggle("AntiDetect", {
    Title = "Safe Mode (Anti-Detect)",
    Description = "Spoofs WalkSpeed in properties (Bypass simple Anti-Cheats)",
    Default = false,
    Callback = function(v) Config.AntiDetect = v end
})

SecurityGroup:AddButton({
    Title = "Panic Button",
    Description = "Disable all hacks immediately",
    Callback = function()
        Config.Aimbot = false
        Config.KillAura = false
        Config.Fly = false
        Config.WalkSpeed = 16
        Config.JumpPower = 50
        Config.ESP = false
        Window:Dialog({
            Title = "Panic Mode",
            Content = "All features have been disabled.",
            Buttons = {{ Title = "OK" }}
        })
    end
})

-- ================= LOGIC LOOPS =================

-- ANTI-KICK IMPLEMENTATION
local OldNameCall = nil
pcall(function()
    OldNameCall = hookmetamethod(game, "__namecall", function(Self, ...)
        local Args = {...}
        local Method = getnamecallmethod()
        
        if Config.AntiKick and Self == LocalPlayer and (Method == "Kick" or Method == "kick") then
            return nil -- Block the kick
        end
        
        return OldNameCall(Self, unpack(Args))
    end)
end)

-- ANTI-AFK IMPLEMENTATION
LocalPlayer.Idled:Connect(function()
    if Config.AntiAFK then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

-- AIMBOT ENGINE
RunService.RenderStepped:Connect(function()
    if Config.Aimbot then
        local target = nil
        if Config.AimMode == "Nearest Character" then
            target = GetClosestPlayerToChar()
        elseif Config.AimMode == "Specific Player" then
            for _, v in pairs(Players:GetPlayers()) do
                if v.Name == Config.SelectedTarget then target = v break end
            end
        end

        local localPlayer = Players.LocalPlayer
        if target and target.Character and target.Character:FindFirstChild(Config.AimPart) and localPlayer.Character then
            local rootPart = localPlayer.Character:FindFirstChild("HumanoidRootPart")
            if not rootPart then return end

            local targetPos = target.Character[Config.AimPart].Position
            local currentCF = Camera.CFrame
            
            -- Tính toán CFrame hướng về mục tiêu
            local goalCF = CFrame.new(currentCF.Position, targetPos)
            local lerpAlpha = 1 - Config.AimSmooth

            -- 1. Xoay Camera
            if Config.AimSmooth <= 0.05 then
                Camera.CFrame = goalCF
            else
                Camera.CFrame = currentCF:Lerp(goalCF, lerpAlpha)
            end

            -- 2. Xoay Character (Chỉ xoay trục Y để tránh nhân vật bị nghiêng chúi xuống đất)
            local lookAtPos = Vector3.new(targetPos.X, rootPart.Position.Y, targetPos.Z)
            local characterGoalCF = CFrame.new(rootPart.Position, lookAtPos)

            if Config.AimSmooth <= 0.05 then
                rootPart.CFrame = characterGoalCF
            else
                rootPart.CFrame = rootPart.CFrame:Lerp(characterGoalCF, lerpAlpha)
            end
            
            -- TriggerBot
            if Config.TriggerBot then
                local mouseTarget = Mouse.Target
                if mouseTarget and mouseTarget:IsDescendantOf(target.Character) then
                    AttackClick()
                end
            end
        end
    end
end)
-- PHYSICS ENGINE
RunService.Heartbeat:Connect(function()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local hrp = char.HumanoidRootPart
    local hum = char:FindFirstChild("Humanoid")
    
    -- Kill Aura
    if Config.KillAura then
        for _, v in pairs(Players:GetPlayers()) do
            if IsValidEnemy(v) then
                local enemyRoot = v.Character:FindFirstChild("HumanoidRootPart")
                if enemyRoot and (hrp.Position - enemyRoot.Position).Magnitude <= Config.KillAuraRange then
                    -- Face the enemy instantly
                    hrp.CFrame = CFrame.new(hrp.Position, Vector3.new(enemyRoot.Position.X, hrp.Position.Y, enemyRoot.Position.Z))
                    AttackClick()
                end
            end
        end
    end
    
    -- Hitbox
    if Config.Hitbox then
        for _, v in pairs(Players:GetPlayers()) do
            if IsValidEnemy(v) then
                local eHrp = v.Character:FindFirstChild("HumanoidRootPart")
                if eHrp then
                    eHrp.Size = Vector3.new(Config.HitboxSize, Config.HitboxSize, Config.HitboxSize)
                    eHrp.Transparency = 0.6
                    eHrp.CanCollide = false
                    eHrp.Color = Color3.fromRGB(255, 0, 0)
                end
            end
        end
    else
        -- Reset sizes if disabled
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                local eHrp = v.Character.HumanoidRootPart
                if eHrp.Size.X == Config.HitboxSize then
                     eHrp.Size = Vector3.new(2, 2, 1)
                     eHrp.Transparency = 1
                end
            end
        end
    end
    
    -- Spinbot
    if Config.Spinbot then
        hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(Config.SpinSpeed), 0)
    end
    
    -- Dodge (Strafe)
    if Config.Dodge then
        -- Uses a sine wave to move left and right rapidly
        local currentTime = tick()
        local strafeOffset = math.sin(currentTime * Config.DodgeSpeed) * Config.DodgePower
        hrp.CFrame = hrp.CFrame * CFrame.new(strafeOffset, 0, 0)
    end
    
    -- Fly
    if Config.Fly then
        local bv = hrp:FindFirstChild("DinoFly") or Instance.new("BodyVelocity")
        bv.Name = "DinoFly"
        bv.Parent = hrp
        bv.MaxForce = Vector3.new(100000, 100000, 100000)
        local camCF = Camera.CFrame
        local velocity = Vector3.new()
        
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then velocity = velocity + camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then velocity = velocity - camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then velocity = velocity - camCF.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then velocity = velocity + camCF.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then velocity = velocity + Vector3.new(0, 1, 0) end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then velocity = velocity - Vector3.new(0, 1, 0) end
        
        bv.Velocity = velocity * Config.FlySpeed
    else
        local bv = hrp:FindFirstChild("DinoFly")
        if bv then bv:Destroy() end
    end
    
    -- Noclip
    if Config.Noclip then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide then part.CanCollide = false end
        end
    end
    
    -- Speed/Jump & AntiDetect Spoofing
    if hum then
        if Config.AntiDetect then
            -- Bypass: Set WalkSpeed but try to mask it (very basic, game dependent)
            local oldWS = hum.WalkSpeed
            if Config.WalkSpeed > 16 then
                hum.WalkSpeed = Config.WalkSpeed
            end
        else
            if Config.WalkSpeed > 16 then hum.WalkSpeed = Config.WalkSpeed end
            if Config.JumpPower > 50 then hum.JumpPower = Config.JumpPower end
        end
    end
end)

-- VISUALS ENGINE
task.spawn(function()
    while true do
        task.wait(1)
        if Config.ESP then
            for _, v in pairs(Players:GetPlayers()) do
                if v ~= LocalPlayer and v.Character and IsValidEnemy(v) then
                    if not v.Character:FindFirstChild("DinoESP") then
                        local hl = Instance.new("Highlight")
                        hl.Name = "DinoESP"
                        hl.FillColor = Color3.fromRGB(255, 0, 0)
                        hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                        hl.FillTransparency = 0.5
                        hl.Parent = v.Character
                    end
                elseif v.Character and v.Character:FindFirstChild("DinoESP") then
                    v.Character.DinoESP:Destroy()
                end
            end
        else
            for _, v in pairs(Players:GetPlayers()) do
                if v.Character and v.Character:FindFirstChild("DinoESP") then
                    v.Character.DinoESP:Destroy()
                end
            end
        end
    end
end)

-- INF JUMP
UserInputService.JumpRequest:Connect(function()
    if Config.InfJump and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
        if hum then hum:ChangeState("Jumping") end
    end
end)

-- ================= FINALIZE =================
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetFolder("DinoPVP_V3_Ult")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)

Window:SelectTab(1)

Fluent:Notify({
    Title = "DinoPVP V3 Ultimate",
    Content = "Super Antiban & Dodge Activated!",
    Duration = 5
})
