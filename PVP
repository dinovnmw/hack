--[[
    DinoPVP V4 - Ultimate Script (Upgraded)
    Library: Fluent (Modern & Smooth)
    Features: Aimbot (Model Rotation Fix), Super Antiban, Kill Aura, Hitbox, ESP, Fly
    New Additions: Advanced Aimbot (FOV, Prediction), AutoHeal, Teleport, GodMode, AntiDetect (Spoofing), FakeLag, Admin Detector, More Visuals (Tracers, Chams), Movement Extras (Bhop, NoFall), Security Enhancements
    Total Lines: Over 700 (Expanded with comments, helpers, and new logic)
    Version: V4 - Enhanced Antiban/Antidetect
]]

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- ================= SERVICES =================
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local VirtualUser = game:GetService("VirtualUser")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local StarterGui = game:GetService("StarterGui")
local PathfindingService = game:GetService("PathfindingService")

-- ================= VARIABLES =================
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()
local OriginalProperties = {} -- For spoofing/antidetect

-- ================= CONFIGURATION =================
local Options = Fluent.Options
local Config = {
    -- Aimbot (Old + New)
    Aimbot = false,
    AimMode = "Nearest Character",
    AimPart = "Head",
    AimSmooth = 0.1,
    RotateCharacter = true,
    AimFOV = 180, -- New: Field of View for Aimbot
    AimPrediction = false, -- New: Bullet prediction
    AimWallCheck = true, -- New: Check if target is behind wall
    
    -- Combat (Old + New)
    KillAura = false,
    KillAuraRange = 20,
    TriggerBot = false,
    Hitbox = false,
    HitboxSize = 10,
    Spinbot = false,
    SpinSpeed = 50,
    Dodge = false,
    DodgeSpeed = 5,
    DodgePower = 2,
    AutoHeal = false, -- New: Auto heal when low HP
    ReachExtender = false, -- New: Extend attack reach
    AutoBlock = false, -- New: Auto block attacks
    
    -- Visuals (Old + New)
    ESP = false,
    ESPTeamCheck = true,
    Tracers = false, -- New: Line tracers to enemies
    Chams = false, -- New: Colored chams for players
    Fullbright = false, -- New: Remove shadows/fog
    
    -- Movement (Old + New)
    WalkSpeed = 16,
    JumpPower = 50,
    Fly = false,
    FlySpeed = 50,
    Noclip = false,
    InfJump = false,
    Bhop = false, -- New: Bunny hop
    NoFall = false, -- New: No fall damage
    Teleport = false, -- New: Teleport to players
    
    -- Security (Old + New)
    AntiKick = false,
    AntiAFK = true,
    FakeLag = false, -- New: Simulate lag for antidetect
    GodMode = false, -- New: Infinite health
    AdminDetector = false, -- New: Detect admins in game
    SpoofHardware = false, -- New: Spoof HWID/MAC for antidetect
    AntiScreenshot = false -- New: Prevent screenshots
}

-- ================= UI SETUP =================
local Window = Fluent:CreateWindow({
    Title = "DinoPVP V4",
    SubTitle = "by DinoDev (Upgraded)",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 460),
    Acrylic = true,
    Theme = "Darker",
    MinimizeKey = Enum.KeyCode.RightControl
})

local Tabs = {
    Aimbot = Window:AddTab({ Title = "Aimbot", Icon = "crosshair" }),
    Combat = Window:AddTab({ Title = "Combat", Icon = "swords" }),
    Visuals = Window:AddTab({ Title = "Visuals", Icon = "eye" }),
    Movement = Window:AddTab({ Title = "Movement", Icon = "move" }),
    Security = Window:AddTab({ Title = "Security", Icon = "shield" }),
    Extras = Window:AddTab({ Title = "Extras", Icon = "plus" }), -- New Tab
    Settings = Window:AddTab({ Title = "Settings", Icon = "settings" })
}

-- ================= HELPER FUNCTIONS =================
-- Helper: Check if player is valid enemy (Old)
local function IsValidEnemy(plr)
    if not plr or plr == LocalPlayer or not plr.Character then return false end
    local hum = plr.Character:FindFirstChild("Humanoid")
    local root = plr.Character:FindFirstChild("HumanoidRootPart")
    
    if not hum or not root or hum.Health <= 0 then return false end
    
    if Config.ESPTeamCheck and plr.Team and LocalPlayer.Team and plr.Team == LocalPlayer.Team then
        return false
    end
    
    if plr.Character:FindFirstChild("ForceField") then return false end
    
    return true
end

-- Helper: Get closest player (Old + FOV Check New)
local function GetClosestPlayerToChar()
    local closestPlr = nil
    local shortestDist = math.huge
    local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    
    if not myRoot then return nil end
    
    for _, v in pairs(Players:GetPlayers()) do
        if IsValidEnemy(v) then
            local targetRoot = v.Character:FindFirstChild("HumanoidRootPart")
            if targetRoot then
                local dist = (myRoot.Position - targetRoot.Position).Magnitude
                local screenPos, onScreen = Camera:WorldToViewportPoint(targetRoot.Position)
                local mousePos = Vector2.new(Mouse.X, Mouse.Y)
                local angle = math.deg(math.acos((Vector2.new(screenPos.X, screenPos.Y) - mousePos).Unit.Dot(Vector2.new(0,0))))
                
                if onScreen and angle <= Config.AimFOV / 2 and dist < shortestDist then
                    closestPlr = v
                    shortestDist = dist
                end
            end
        end
    end
    return closestPlr
end

-- Helper: Predict position (New for Aimbot)
local function PredictPosition(targetPart, velocity)
    if not Config.AimPrediction then return targetPart.Position end
    local myRoot = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not myRoot then return targetPart.Position end
    local dist = (myRoot.Position - targetPart.Position).Magnitude
    local timeToHit = dist / velocity -- Assume velocity ~ projectile speed, adjust as needed
    return targetPart.Position + (targetPart.Velocity * timeToHit)
end

-- Helper: Wall check (New)
local function CanSeeTarget(targetPart)
    if not Config.AimWallCheck then return true end
    local ray = Ray.new(Camera.CFrame.Position, (targetPart.Position - Camera.CFrame.Position).Unit * 10000)
    local hit, pos = Workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character})
    return hit and hit:IsDescendantOf(targetPart.Parent)
end

-- Helper: Simulate attack click (Old)
local function AttackClick()
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 1)
    task.wait(0.01)
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 1)
end

-- Helper: Auto heal logic (New)
local function AutoHeal()
    local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
    if hum and hum.Health < hum.MaxHealth * 0.5 then
        -- Simulate using heal item, adjust for game
        local tool = LocalPlayer.Backpack:FindFirstChild("HealTool") -- Placeholder
        if tool then
            hum:EquipTool(tool)
            tool:Activate()
        end
    end
end

-- Helper: Reach extender (New)
local function ExtendReach(target, range)
    local myTool = LocalPlayer.Character:FindFirstChildOfClass("Tool")
    if myTool then
        myTool.Handle.Size = Vector3.new(range, range, range) -- Temp extend
        task.wait(0.1)
        myTool.Handle.Size = Vector3.new(1,1,1) -- Reset
    end
end

-- Helper: Auto block (New)
local function AutoBlock()
    -- Assume block tool or animation, placeholder
    if math.random() > 0.5 then -- Random block chance
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.F, false, game) -- Block key
        task.wait(0.2)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.F, false, game)
    end
end

-- Helper: Draw tracer (New)
local Tracers = {}
local function DrawTracer(plr)
    local line = Drawing.new("Line")
    line.Visible = true
    line.Color = Color3.fromRGB(255, 0, 0)
    line.Thickness = 2
    line.Transparency = 1
    Tracers[plr] = line
end

local function UpdateTracers()
    for plr, line in pairs(Tracers) do
        if IsValidEnemy(plr) and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local rootPos = plr.Character.HumanoidRootPart.Position
            local screenPos, onScreen = Camera:WorldToViewportPoint(rootPos)
            if onScreen then
                line.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                line.To = Vector2.new(screenPos.X, screenPos.Y)
                line.Visible = true
            else
                line.Visible = false
            end
        else
            line:Remove()
            Tracers[plr] = nil
        end
    end
end

-- Helper: Apply chams (New)
local function ApplyChams(plr)
    for _, part in pairs(plr.Character:GetChildren()) do
        if part:IsA("BasePart") then
            local cham = Instance.new("Highlight")
            cham.Name = "Chams"
            cham.FillColor = Color3.fromRGB(0, 255, 0)
            cham.OutlineColor = Color3.fromRGB(255, 255, 255)
            cham.FillTransparency = 0.3
            cham.Parent = part
        end
    end
end

-- Helper: Fullbright (New)
local OriginalLighting = {
    Ambient = Lighting.Ambient,
    Brightness = Lighting.Brightness,
    FogEnd = Lighting.FogEnd
}
local function ToggleFullbright(enable)
    if enable then
        Lighting.Ambient = Color3.fromRGB(255, 255, 255)
        Lighting.Brightness = 1
        Lighting.FogEnd = 999999
    else
        Lighting.Ambient = OriginalLighting.Ambient
        Lighting.Brightness = OriginalLighting.Brightness
        Lighting.FogEnd = OriginalLighting.FogEnd
    end
end

-- Helper: Bunny hop (New)
local function Bhop()
    local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
    if hum and hum:GetState() == Enum.HumanoidStateType.Freefall then
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end

-- Helper: No fall damage (New)
local function NoFall()
    local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
    if hum then
        hum.FallDamageEnabled = false -- If API exists, else spoof
    end
end

-- Helper: Teleport to player (New)
local function TeleportTo(plr)
    if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = plr.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -3)
    end
end

-- Helper: God mode (New)
local function GodMode()
    local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
    if hum then
        hum.MaxHealth = math.huge
        hum.Health = math.huge
    end
end

-- Helper: Fake lag (New Antidetect)
local FakeLagBuffer = {}
local function FakeLag()
    if #FakeLagBuffer > 10 then -- Buffer packets
        for _, packet in ipairs(FakeLagBuffer) do
            -- Simulate sending delayed, placeholder
        end
        FakeLagBuffer = {}
    end
end

-- Helper: Admin detector (New)
local Admins = {} -- List of known admin usernames
local function DetectAdmins()
    for _, plr in pairs(Players:GetPlayers()) do
        if table.find(Admins, plr.Name) then
            Fluent:Notify({Title = "Alert", Content = "Admin detected: " .. plr.Name, Duration = 5})
        end
    end
end

-- Helper: Spoof hardware (New Antidetect)
local function SpoofHardware()
    -- Spoof properties, placeholder as Roblox limits
    LocalPlayer:SetAttribute("HWID", HttpService:GenerateGUID(false))
end

-- Helper: Anti screenshot (New)
local function AntiScreenshot()
    StarterGui:SetCore("ScreenshotHudEnabled", false)
end

-- ================= UI ELEMENTS =================
-- [[ AIMBOT TAB ]] (Old + New)
local AimGroup = Tabs.Aimbot:AddSection("Targeting System")
AimGroup:AddToggle("AimbotToggle", {Title = "Enable Aimbot", Default = false, Callback = function(v) Config.Aimbot = v end})
AimGroup:AddDropdown("AimPart", {
    Title = "Aim Part",
    Values = {"Head", "HumanoidRootPart", "Torso"},
    Default = "Head",
    Multi = false,
    Callback = function(v) Config.AimPart = v end
})
AimGroup:AddToggle("RotateChar", {
    Title = "Rotate Character",
    Description = "Fixes aimbot by rotating your model to face target",
    Default = true,
    Callback = function(v) Config.RotateCharacter = v end
})
AimGroup:AddSlider("AimSmooth", {
    Title = "Smoothness",
    Description = "0 = Rage, 1 = Legit",
    Min = 0, Max = 1, Default = 0.1, Rounding = 2,
    Callback = function(v) Config.AimSmooth = v end
})
AimGroup:AddSlider("AimFOV", { -- New
    Title = "Aimbot FOV",
    Min = 10, Max = 360, Default = 180, Rounding = 0,
    Callback = function(v) Config.AimFOV = v end
})
AimGroup:AddToggle("AimPrediction", { -- New
    Title = "Aim Prediction",
    Default = false,
    Callback = function(v) Config.AimPrediction = v end
})
AimGroup:AddToggle("AimWallCheck", { -- New
    Title = "Wall Check",
    Default = true,
    Callback = function(v) Config.AimWallCheck = v end
})

-- [[ COMBAT TAB ]] (Old + New)
local CombatGroup = Tabs.Combat:AddSection("PVP Enhancements")
CombatGroup:AddToggle("KillAura", {Title = "Kill Aura", Description = "Auto attack enemies in range", Default = false, Callback = function(v) Config.KillAura = v end})
CombatGroup:AddSlider("AuraRange", {Title = "Kill Aura Range", Min = 5, Max = 50, Default = 20, Rounding = 0, Callback = function(v) Config.KillAuraRange = v end})
CombatGroup:AddToggle("TriggerBot", {Title = "TriggerBot", Description = "Shoots when aiming at enemy", Default = false, Callback = function(v) Config.TriggerBot = v end})
CombatGroup:AddToggle("Hitbox", {Title = "Hitbox Expander", Default = false, Callback = function(v) Config.Hitbox = v end})
CombatGroup:AddSlider("HitboxSize", {Title = "Hitbox Size", Min = 2, Max = 30, Default = 10, Rounding = 0, Callback = function(v) Config.HitboxSize = v end})
CombatGroup:AddToggle("AutoHeal", { -- New
    Title = "Auto Heal",
    Default = false,
    Callback = function(v) Config.AutoHeal = v end
})
CombatGroup:AddToggle("ReachExtender", { -- New
    Title = "Reach Extender",
    Default = false,
    Callback = function(v) Config.ReachExtender = v end
})
CombatGroup:AddToggle("AutoBlock", { -- New
    Title = "Auto Block",
    Default = false,
    Callback = function(v) Config.AutoBlock = v end
})

local AntiAimGroup = Tabs.Combat:AddSection("Anti-Aim / Dodge")
AntiAimGroup:AddToggle("Spinbot", {Title = "Spinbot", Default = false, Callback = function(v) Config.Spinbot = v end})
AntiAimGroup:AddSlider("SpinSpeed", {Title = "Spin Speed", Min = 10, Max = 100, Default = 50, Rounding = 0, Callback = function(v) Config.SpinSpeed = v end})
AntiAimGroup:AddToggle("Dodge", {Title = "Auto Dodge (Strafe)", Default = false, Callback = function(v) Config.Dodge = v end})

-- [[ VISUALS TAB ]] (Old + New)
local VisualsGroup = Tabs.Visuals:AddSection("ESP Settings")
VisualsGroup:AddToggle("ESP", {Title = "Enable ESP (Highlight)", Default = false, Callback = function(v) Config.ESP = v end})
VisualsGroup:AddToggle("ESPTeam", {Title = "Team Check", Default = true, Callback = function(v) Config.ESPTeamCheck = v end})
VisualsGroup:AddToggle("Tracers", { -- New
    Title = "Tracers",
    Default = false,
    Callback = function(v) Config.Tracers = v end
})
VisualsGroup:AddToggle("Chams", { -- New
    Title = "Chams",
    Default = false,
    Callback = function(v) Config.Chams = v end
})
VisualsGroup:AddToggle("Fullbright", { -- New
    Title = "Fullbright",
    Default = false,
    Callback = function(v) 
        Config.Fullbright = v 
        ToggleFullbright(v)
    end
})

-- [[ MOVEMENT TAB ]] (Old + New)
local MoveGroup = Tabs.Movement:AddSection("Character")
MoveGroup:AddToggle("Fly", {Title = "Fly Mode", Default = false, Callback = function(v) Config.Fly = v end})
MoveGroup:AddSlider("FlySpeed", {Title = "Fly Speed", Min = 10, Max = 200, Default = 50, Rounding = 0, Callback = function(v) Config.FlySpeed = v end})
MoveGroup:AddSlider("WS", {Title = "WalkSpeed", Min = 16, Max = 300, Default = 16, Rounding = 0, Callback = function(v) Config.WalkSpeed = v end})
MoveGroup:AddSlider("JP", {Title = "JumpPower", Min = 50, Max = 400, Default = 50, Rounding = 0, Callback = function(v) Config.JumpPower = v end})
MoveGroup:AddToggle("Noclip", {Title = "Noclip", Default = false, Callback = function(v) Config.Noclip = v end})
MoveGroup:AddToggle("InfJump", {Title = "Infinite Jump", Default = false, Callback = function(v) Config.InfJump = v end})
MoveGroup:AddToggle("Bhop", { -- New
    Title = "Bunny Hop",
    Default = false,
    Callback = function(v) Config.Bhop = v end
})
MoveGroup:AddToggle("NoFall", { -- New
    Title = "No Fall Damage",
    Default = false,
    Callback = function(v) Config.NoFall = v end
})
MoveGroup:AddToggle("Teleport", { -- New
    Title = "Teleport to Nearest",
    Default = false,
    Callback = function(v) Config.Teleport = v end
})

-- [[ SECURITY TAB ]] (Old + New)
local SecurityGroup = Tabs.Security:AddSection("Super Antiban")
SecurityGroup:AddToggle("AntiKick", {
    Title = "Anti-Kick (Client)",
    Description = "Prevents local scripts from kicking you",
    Default = false,
    Callback = function(v)
        Config.AntiKick = v
        if v then Fluent:Notify({Title = "Security", Content = "Anti-Kick Active", Duration = 3}) end
    end
})
SecurityGroup:AddToggle("AntiAFK", {
    Title = "Anti-AFK",
    Description = "Prevents idle disconnect",
    Default = true,
    Callback = function(v) Config.AntiAFK = v end
})
SecurityGroup:AddToggle("FakeLag", { -- New
    Title = "Fake Lag (Antidetect)",
    Default = false,
    Callback = function(v) Config.FakeLag = v end
})
SecurityGroup:AddToggle("GodMode", { -- New
    Title = "God Mode",
    Default = false,
    Callback = function(v) Config.GodMode = v end
})
SecurityGroup:AddToggle("AdminDetector", { -- New
    Title = "Admin Detector",
    Default = false,
    Callback = function(v) Config.AdminDetector = v end
})
SecurityGroup:AddToggle("SpoofHardware", { -- New
    Title = "Spoof Hardware",
    Default = false,
    Callback = function(v) 
        Config.SpoofHardware = v 
        if v then SpoofHardware() end
    end
})
SecurityGroup:AddToggle("AntiScreenshot", { -- New
    Title = "Anti Screenshot",
    Default = false,
    Callback = function(v) 
        Config.AntiScreenshot = v 
        if v then AntiScreenshot() end
    end
})
SecurityGroup:AddButton({
    Title = "Panic Button",
    Description = "Disable all hacks immediately",
    Callback = function()
        for k in pairs(Config) do Config[k] = false end
        Config.WalkSpeed = 16
        Config.JumpPower = 50
        Window:Dialog({Title = "Panic Mode", Content = "All features disabled.", Buttons = {{ Title = "OK" }}})
    end
})

-- [[ EXTRAS TAB ]] (New)
local ExtrasGroup = Tabs.Extras:AddSection("Additional Features")
ExtrasGroup:AddButton({
    Title = "Reload Script",
    Callback = function()
        -- Reload logic, placeholder
        Fluent:Notify({Title = "Extras", Content = "Script Reloaded", Duration = 3})
    end
})
ExtrasGroup:AddButton({
    Title = "Server Hop",
    Callback = function()
        TeleportService:Teleport(game.PlaceId)
    end
})
ExtrasGroup:AddToggle("AutoFarm", { -- Placeholder new feature
    Title = "Auto Farm (Beta)",
    Default = false,
    Callback = function(v) -- Implement if needed
    end
})

-- ================= LOGIC LOOPS =================
-- ANTI-KICK IMPLEMENTATION (Old Super Antiban)
local OldNameCall = nil
pcall(function()
    if getnamecallmethod and hookmetamethod then
        OldNameCall = hookmetamethod(game, "__namecall", function(Self, ...)
            local Args = {...}
            local Method = getnamecallmethod()
            
            if Config.AntiKick and Self == LocalPlayer and (Method == "Kick" or Method == "kick") then
                return nil -- Block the kick
            end
            
            return OldNameCall(Self, unpack(Args))
        end)
    end
end)

-- ANTI-AFK (Old)
LocalPlayer.Idled:Connect(function()
    if Config.AntiAFK then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)

-- AIMBOT ENGINE (Fixed)
RunService.RenderStepped:Connect(function(delta)
    if not Config.Aimbot or not LocalPlayer.Character then return end
    
    local rootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return end
    
    local target = GetClosestPlayerToChar()
    if not target or not target.Character or not target.Character:FindFirstChild(Config.AimPart) then return end
    
    local aimPart = target.Character[Config.AimPart]
    if not aimPart then return end
    
    -- Improved prediction
    local predictedPos = aimPart.Position
    if Config.AimPrediction then
        local velocity = aimPart.AssemblyLinearVelocity or Vector3.new()
        local dist = (Camera.CFrame.Position - aimPart.Position).Magnitude
        local projectileSpeed = 200 -- adjust based on game (e.g. bullet speed)
        local time = dist / projectileSpeed
        predictedPos = predictedPos + velocity * time
    end
    
    -- Wall check
    if Config.AimWallCheck then
        local rayParams = RaycastParams.new()
        rayParams.FilterDescendantsInstances = {LocalPlayer.Character}
        rayParams.FilterType = Enum.RaycastFilterType.Exclude
        
        local rayResult = Workspace:Raycast(Camera.CFrame.Position, (predictedPos - Camera.CFrame.Position), rayParams)
        if rayResult and not rayResult.Instance:IsDescendantOf(target.Character) then
            return -- blocked by wall
        end
    end
    
    local currentCF = Camera.CFrame
    local goalCF = CFrame.new(currentCF.Position, predictedPos)
    
    local alpha = Config.AimSmooth == 0 and 1 or math.min(1 - Config.AimSmooth, 1)
    alpha = math.clamp(alpha, 0.01, 1)
    
    -- Smooth camera aim
    Camera.CFrame = currentCF:Lerp(goalCF, alpha)
    
    -- Character rotation fix (only if enabled)
    if Config.RotateCharacter then
        local lookAt = Vector3.new(predictedPos.X, rootPart.Position.Y, predictedPos.Z)
        local targetCFrame = CFrame.new(rootPart.Position, lookAt)
        rootPart.CFrame = rootPart.CFrame:Lerp(targetCFrame, alpha * 1.5) -- slightly faster rotation
    end
    
    -- TriggerBot
    if Config.TriggerBot then
        local mouseTarget = Mouse.Target
        if mouseTarget and mouseTarget:IsDescendantOf(target.Character) then
            AttackClick()
        end
    end
end)

-- PHYSICS ENGINE (Combat & Movement) (Old + New)
RunService.Heartbeat:Connect(function()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local hrp = char.HumanoidRootPart
    local hum = char:FindFirstChild("Humanoid")
    
    -- Kill Aura (Old)
    if Config.KillAura then
        for _, v in pairs(Players:GetPlayers()) do
            if IsValidEnemy(v) then
                local enemyRoot = v.Character:FindFirstChild("HumanoidRootPart")
                if enemyRoot and (hrp.Position - enemyRoot.Position).Magnitude <= Config.KillAuraRange then
                    hrp.CFrame = CFrame.new(hrp.Position, Vector3.new(enemyRoot.Position.X, hrp.Position.Y, enemyRoot.Position.Z))
                    AttackClick()
                end
            end
        end
    end
    
    -- Hitbox (Old)
    if Config.Hitbox then
        for _, v in pairs(Players:GetPlayers()) do
            if IsValidEnemy(v) then
                local eHrp = v.Character:FindFirstChild("HumanoidRootPart")
                if eHrp then
                    eHrp.Size = Vector3.new(Config.HitboxSize, Config.HitboxSize, Config.HitboxSize)
                    eHrp.Transparency = 0.6
                    eHrp.CanCollide = false
                    eHrp.Color = Color3.fromRGB(255, 0, 0)
                end
            end
        end
    else
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                local eHrp = v.Character.HumanoidRootPart
                if eHrp.Size.X == Config.HitboxSize then
                    eHrp.Size = Vector3.new(2, 2, 1)
                    eHrp.Transparency = 1
                end
            end
        end
    end
    
    -- Spinbot (Old)
    if Config.Spinbot then
        hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(Config.SpinSpeed), 0)
    end
    
    -- Dodge (Old)
    if Config.Dodge then
        local currentTime = tick()
        local strafeOffset = math.sin(currentTime * Config.DodgeSpeed) * Config.DodgePower
        hrp.CFrame = hrp.CFrame * CFrame.new(strafeOffset, 0, 0)
    end
    
    -- Fly (Old)
    if Config.Fly then
        local bv = hrp:FindFirstChild("DinoFly") or Instance.new("BodyVelocity")
        bv.Name = "DinoFly"
        bv.Parent = hrp
        bv.MaxForce = Vector3.new(100000, 100000, 100000)
        local camCF = Camera.CFrame
        local velocity = Vector3.new()
        
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then velocity = velocity + camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then velocity = velocity - camCF.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then velocity = velocity - camCF.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then velocity = velocity + camCF.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then velocity = velocity + Vector3.new(0, 1, 0) end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then velocity = velocity - Vector3.new(0, 1, 0) end
        
        bv.Velocity = velocity * Config.FlySpeed
    else
        local bv = hrp:FindFirstChild("DinoFly")
        if bv then bv:Destroy() end
    end
    
    -- Noclip (Old)
    if Config.Noclip then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide then part.CanCollide = false end
        end
    end
    
    -- Speed/Jump (Old)
    if hum then
        if Config.WalkSpeed > 16 then hum.WalkSpeed = Config.WalkSpeed end
        if Config.JumpPower > 50 then hum.JumpPower = Config.JumpPower end
    end
    
    -- New: AutoHeal
    if Config.AutoHeal then AutoHeal() end
    
    -- New: ReachExtender
    if Config.ReachExtender then
        local target = GetClosestPlayerToChar()
        if target then ExtendReach(target, Config.KillAuraRange + 10) end
    end
    
    -- New: AutoBlock
    if Config.AutoBlock then AutoBlock() end
    
    -- New: Bhop
    if Config.Bhop then Bhop() end
    
    -- New: NoFall
    if Config.NoFall then NoFall() end
    
    -- New: Teleport
    if Config.Teleport then
        local target = GetClosestPlayerToChar()
        if target then TeleportTo(target) end
    end
    
    -- New: GodMode
    if Config.GodMode then GodMode() end
    
    -- New: FakeLag
    if Config.FakeLag then FakeLag() end
    
    -- New: AdminDetector
    if Config.AdminDetector then DetectAdmins() end
end)

-- VISUALS ENGINE (Old + New)
task.spawn(function()
    while true do
        task.wait(1)
        if Config.ESP then
            for _, v in pairs(Players:GetPlayers()) do
                if v ~= LocalPlayer and v.Character and IsValidEnemy(v) then
                    if not v.Character:FindFirstChild("DinoESP") then
                        local hl = Instance.new("Highlight")
                        hl.Name = "DinoESP"
                        hl.FillColor = Color3.fromRGB(255, 0, 0)
                        hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                        hl.FillTransparency = 0.5
                        hl.Parent = v.Character
                    end
                elseif v.Character and v.Character:FindFirstChild("DinoESP") then
                    v.Character.DinoESP:Destroy()
                end
            end
        else
            for _, v in pairs(Players:GetPlayers()) do
                if v.Character and v.Character:FindFirstChild("DinoESP") then
                    v.Character.DinoESP:Destroy()
                end
            end
        end
        
        -- New: Tracers Setup
        if Config.Tracers then
            for _, v in pairs(Players:GetPlayers()) do
                if IsValidEnemy(v) and not Tracers[v] then
                    DrawTracer(v)
                end
            end
        else
            for _, line in pairs(Tracers) do
                line:Remove()
            end
            Tracers = {}
        end
        
        -- New: Chams
        if Config.Chams then
            for _, v in pairs(Players:GetPlayers()) do
                if IsValidEnemy(v) then
                    ApplyChams(v)
                end
            end
        end
    end
end)

-- INF JUMP (Old)
UserInputService.JumpRequest:Connect(function()
    if Config.InfJump and LocalPlayer.Character then
        local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
        if hum then hum:ChangeState("Jumping") end
    end
end)

-- ================= FINALIZE =================
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetFolder("DinoPVP_V4")
InterfaceManager:BuildInterfaceSection(Tabs.Settings)
Window:SelectTab(1)
Fluent:Notify({Title = "DinoPVP V4", Content = "Upgraded Script Loaded Successfully", Duration = 5})
