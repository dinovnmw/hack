-- [[ FLUENT PREMIUM UI LIBRARY V4 ]] --
-- Cấu trúc: Fluent UI Style, Save/Load Config, Draggable, Smooth Animations

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")

local Library = {
    CurrentTab = nil,
    Config = {},
    Flags = {},
    Theme = {
        Main = Color3.fromRGB(20, 20, 20),
        Sidebar = Color3.fromRGB(25, 25, 25),
        Accent = Color3.fromRGB(0, 162, 255),
        Outline = Color3.fromRGB(45, 45, 45),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(180, 180, 180),
    }
}

-- [UTILITY FUNCTIONS] --
local function MakeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true; dragStart = input.Position; startPos = frame.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            TweenService:Create(frame, TweenInfo.new(0.1), {
                Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            }):Play()
        end
    end)
    handle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
end

-- [CONFIG SYSTEM] --
function Library:SaveConfig(name)
    local success, encoded = pcall(function() return HttpService:JSONEncode(self.Flags) end)
    if success then
        if not isfolder("FluentPremium") then makefolder("FluentPremium") end
        writefile("FluentPremium/" .. name .. ".json", encoded)
        Library:Notify("Config", "Đã lưu cấu hình: " .. name, 3)
    end
end

function Library:LoadConfig(name)
    local path = "FluentPremium/" .. name .. ".json"
    if isfile(path) then
        local data = HttpService:JSONDecode(readfile(path))
        for i, v in pairs(data) do self.Flags[i] = v end
        Library:Notify("Config", "Đã tải cấu hình thành công!", 3)
        -- Lưu ý: Cần thêm logic cập nhật UI từ Flags tùy vào loại Element
    end
end

-- [MAIN WINDOW] --
function Library:CreateWindow(options)
    local WindowName = options.Name or "Fluent UI"
    local ConfigName = options.ConfigName or "DefaultConfig"
    
    local ScreenGui = Instance.new("ScreenGui", CoreGui)
    ScreenGui.Name = "FluentUI_Pro"
    ScreenGui.ResetOnSpawn = false

    -- Toggle UI Keybind (Default: LeftControl)
    UserInputService.InputBegan:Connect(function(input, gpe)
        if not gpe and input.KeyCode == Enum.KeyCode.LeftControl then
            ScreenGui.Enabled = not ScreenGui.Enabled
        end
    end)

    local Main = Instance.new("Frame", ScreenGui)
    Main.Size = UDim2.fromOffset(600, 420)
    Main.Position = UDim2.fromScale(0.5, 0.5)
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Library.Theme.Main
    Main.BorderSizePixel = 0
    
    local Corner = Instance.new("UICorner", Main)
    Corner.CornerRadius = UDim.new(0, 10)
    
    local Stroke = Instance.new("UIStroke", Main)
    Stroke.Color = Library.Theme.Outline
    Stroke.Thickness = 1.2

    -- Shadow Effect
    local Shadow = Instance.new("ImageLabel", Main)
    Shadow.Size = UDim2.new(1, 40, 1, 40)
    Shadow.Position = UDim2.fromOffset(-20, -20)
    Shadow.Image = "rbxassetid://6015897843"
    Shadow.ImageColor3 = Color3.new(0,0,0)
    Shadow.BackgroundTransparency = 1
    Shadow.ZIndex = -1

    -- Sidebar & Header
    local SideBar = Instance.new("Frame", Main)
    SideBar.Size = UDim2.new(0, 160, 1, 0)
    SideBar.BackgroundColor3 = Library.Theme.Sidebar
    Instance.new("UICorner", SideBar).CornerRadius = UDim.new(0, 10)

    local Title = Instance.new("TextLabel", SideBar)
    Title.Text = WindowName
    Title.Size = UDim2.new(1, 0, 0, 50)
    Title.Font = Enum.Font.GothamBold
    Title.TextColor3 = Library.Theme.Text
    Title.TextSize = 18
    Title.BackgroundTransparency = 1

    local TabContainer = Instance.new("ScrollingFrame", SideBar)
    TabContainer.Size = UDim2.new(1, 0, 1, -60)
    TabContainer.Position = UDim2.fromOffset(0, 55)
    TabContainer.BackgroundTransparency = 1
    TabContainer.ScrollBarThickness = 0
    local TabList = Instance.new("UIListLayout", TabContainer)
    TabList.Padding = UDim.new(0, 5)

    local Container = Instance.new("Frame", Main)
    Container.Size = UDim2.new(1, -170, 1, -20)
    Container.Position = UDim2.fromOffset(170, 10)
    Container.BackgroundTransparency = 1

    MakeDraggable(Main, Title)

    local Window = {}

    function Window:CreateTab(name, icon)
        local Tab = { Active = false }
        local TabBtn = Instance.new("TextButton", TabContainer)
        TabBtn.Size = UDim2.new(1, -10, 0, 35)
        TabBtn.BackgroundColor3 = Library.Theme.Accent
        TabBtn.BackgroundTransparency = 1
        TabBtn.Text = "  " .. name
        TabBtn.Font = Enum.Font.GothamMedium
        TabBtn.TextColor3 = Library.Theme.SubText
        TabBtn.TextSize = 14
        TabBtn.TextXAlignment = Enum.TextXAlignment.Left
        Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0, 6)

        local Page = Instance.new("ScrollingFrame", Container)
        Page.Size = UDim2.fromScale(1, 1)
        Page.BackgroundTransparency = 1
        Page.Visible = false
        Page.ScrollBarThickness = 2
        local PageList = Instance.new("UIListLayout", Page)
        PageList.Padding = UDim.new(0, 8)

        TabBtn.MouseButton1Click:Connect(function()
            for _, t in pairs(TabContainer:GetChildren()) do
                if t:IsA("TextButton") then 
                    TweenService:Create(t, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextColor3 = Library.Theme.SubText}):Play()
                end
            end
            for _, p in pairs(Container:GetChildren()) do p.Visible = false end
            
            TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundTransparency = 0.8, TextColor3 = Library.Theme.Text}):Play()
            Page.Visible = true
        end)

        function Tab:AddToggle(title, default, callback)
            local Toggled = default or false
            Library.Flags[title] = Toggled
            
            local ToggleFrame = Instance.new("TextButton", Page)
            ToggleFrame.Size = UDim2.new(1, -10, 0, 40)
            ToggleFrame.BackgroundColor3 = Library.Theme.Sidebar
            ToggleFrame.AutoButtonColor = false
            ToggleFrame.Text = ""
            local tfc = Instance.new("UICorner", ToggleFrame)
            
            local Label = Instance.new("TextLabel", ToggleFrame)
            Label.Text = title
            Label.Size = UDim2.new(1, -50, 1, 0)
            Label.Position = UDim2.fromOffset(12, 0)
            Label.TextColor3 = Library.Theme.Text
            Label.Font = Enum.Font.Gotham
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1

            local Switch = Instance.new("Frame", ToggleFrame)
            Switch.Size = UDim2.fromOffset(34, 18)
            Switch.Position = UDim2.new(1, -45, 0.5, -9)
            Switch.BackgroundColor3 = Toggled and Library.Theme.Accent or Color3.fromRGB(60, 60, 60)
            Instance.new("UICorner", Switch).CornerRadius = UDim.new(1, 0)

            local Dot = Instance.new("Frame", Switch)
            Dot.Size = UDim2.fromOffset(12, 12)
            Dot.Position = Toggled and UDim2.new(1, -15, 0.5, -6) or UDim2.new(0, 3, 0.5, -6)
            Dot.BackgroundColor3 = Color3.new(1,1,1)
            Instance.new("UICorner", Dot).CornerRadius = UDim.new(1, 0)

            ToggleFrame.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                Library.Flags[title] = Toggled
                TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Toggled and Library.Theme.Accent or Color3.fromRGB(60, 60, 60)}):Play()
                TweenService:Create(Dot, TweenInfo.new(0.2), {Position = Toggled and UDim2.new(1, -15, 0.5, -6) or UDim2.new(0, 3, 0.5, -6)}):Play()
                callback(Toggled)
            end)
        end
        
        -- Thêm các hàm AddButton, AddSlider, AddDropdown tương tự...
        
        return Tab
    end

    -- [SETTINGS TAB] --
    local SettingsTab = Window:CreateTab("Settings")
    SettingsTab:AddToggle("Auto Save Config", true, function(state) print("AutoSave:", state) end)
    
    return Window
end

-- [NOTIFICATION SYSTEM] --
function Library:Notify(title, content, duration)
    -- Thêm hệ thống thông báo mượt mà tại đây
    print("[" .. title .. "]: " .. content)
end

return Library
