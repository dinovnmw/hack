-- FluentLite v2 UI Library
-- Upgraded by Gemini
-- Modern, Smooth, Draggable

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local CoreGui = game:GetService("CoreGui")

local Library = {}
Library.AccentColor = Color3.fromRGB(0, 140, 255) -- Màu chủ đạo
Library.Theme = {
    Main = Color3.fromRGB(20, 20, 20),
    Sidebar = Color3.fromRGB(30, 30, 30),
    Item = Color3.fromRGB(35, 35, 35),
    Text = Color3.fromRGB(240, 240, 240),
    TextDim = Color3.fromRGB(150, 150, 150)
}

-- Utility Functions
local function Tween(obj, props, info)
    local tweenInfo = info or TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
    TweenService:Create(obj, tweenInfo, props):Play()
end

local function MakeDraggable(frame, parent)
    parent = parent or frame
    local dragging, dragInput, dragStart, startPos
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = parent.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Tween(parent, {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}, TweenInfo.new(0.1))
        end
    end)
end

function Library:CreateWindow(settings)
    local Window = {}
    
    -- ScreenGui Setup
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "FluentLiteV2"
    ScreenGui.ResetOnSpawn = false
    -- Tự động chọn CoreGui nếu có thể, không thì PlayerGui
    pcall(function() ScreenGui.Parent = CoreGui end)
    if not ScreenGui.Parent then ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

    -- Main Frame
    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Size = UDim2.fromOffset(550, 380)
    Main.Position = UDim2.fromScale(0.5, 0.5)
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Library.Theme.Main
    Main.BorderSizePixel = 0
    Main.ClipsDescendants = true
    Main.Parent = ScreenGui

    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)
    
    -- Stroke (Viền mỏng)
    local MainStroke = Instance.new("UIStroke", Main)
    MainStroke.Color = Color3.fromRGB(60, 60, 60)
    MainStroke.Thickness = 1

    -- Drag Bar (Invisible)
    local DragBar = Instance.new("Frame", Main)
    DragBar.Size = UDim2.new(1, 0, 0, 40)
    DragBar.BackgroundTransparency = 1
    MakeDraggable(DragBar, Main)

    -- Title
    local Title = Instance.new("TextLabel")
    Title.Text = settings.Title or "FluentLite v2"
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 20
    Title.TextColor3 = Library.Theme.Text
    Title.BackgroundTransparency = 1
    Title.Size = UDim2.new(0, 200, 0, 40)
    Title.Position = UDim2.fromOffset(15, 0)
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = Main

    -- Sidebar (Tabs Area)
    local Sidebar = Instance.new("Frame")
    Sidebar.Size = UDim2.new(0, 140, 1, -50)
    Sidebar.Position = UDim2.fromOffset(10, 50)
    Sidebar.BackgroundColor3 = Library.Theme.Sidebar
    Sidebar.Parent = Main
    Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0, 8)

    local TabList = Instance.new("UIListLayout", Sidebar)
    TabList.Padding = UDim.new(0, 5)
    TabList.SortOrder = Enum.SortOrder.LayoutOrder
    
    local SidebarPadding = Instance.new("UIPadding", Sidebar)
    SidebarPadding.PaddingTop = UDim.new(0, 5)
    SidebarPadding.PaddingLeft = UDim.new(0, 5)

    -- Container (Pages Area)
    local Container = Instance.new("Frame")
    Container.Size = UDim2.new(1, -165, 1, -50)
    Container.Position = UDim2.fromOffset(160, 50)
    Container.BackgroundTransparency = 1
    Container.Parent = Main

    local firstTab = true

    function Window:CreateTab(name)
        local Tab = {}
        
        -- Tab Button
        local TabBtn = Instance.new("TextButton")
        TabBtn.Text = name
        TabBtn.Font = Enum.Font.GothamMedium
        TabBtn.TextSize = 14
        TabBtn.TextColor3 = Library.Theme.TextDim
        TabBtn.BackgroundColor3 = Library.Theme.Main
        TabBtn.BackgroundTransparency = 1
        TabBtn.Size = UDim2.new(1, -10, 0, 32)
        TabBtn.AutoButtonColor = false
        TabBtn.Parent = Sidebar
        
        local TabCorner = Instance.new("UICorner", TabBtn)
        TabCorner.CornerRadius = UDim.new(0, 6)

        -- Page Frame
        local Page = Instance.new("ScrollingFrame")
        Page.Name = name .. "_Page"
        Page.Size = UDim2.fromScale(1, 1)
        Page.BackgroundTransparency = 1
        Page.ScrollBarThickness = 2
        Page.ScrollBarImageColor3 = Library.AccentColor
        Page.Visible = false
        Page.Parent = Container
        
        local PageLayout = Instance.new("UIListLayout", Page)
        PageLayout.Padding = UDim.new(0, 8)
        PageLayout.SortOrder = Enum.SortOrder.LayoutOrder

        PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 10)
        end)

        -- Tab Logic
        local function Activate()
            -- Reset all tabs
            for _, v in pairs(Sidebar:GetChildren()) do
                if v:IsA("TextButton") then
                    Tween(v, {BackgroundTransparency = 1, TextColor3 = Library.Theme.TextDim})
                end
            end
            for _, v in pairs(Container:GetChildren()) do
                if v:IsA("ScrollingFrame") then v.Visible = false end
            end
            
            -- Active current
            Tween(TabBtn, {BackgroundTransparency = 0, TextColor3 = Color3.new(1,1,1)})
            Page.Visible = true
        end

        TabBtn.MouseButton1Click:Connect(Activate)

        if firstTab then
            Activate()
            firstTab = false
        end

        -- ELEMENTS --

        function Tab:AddButton(text, callback)
            local Btn = Instance.new("TextButton")
            Btn.Text = text
            Btn.Font = Enum.Font.Gotham
            Btn.TextSize = 14
            Btn.TextColor3 = Library.Theme.Text
            Btn.BackgroundColor3 = Library.Theme.Item
            Btn.Size = UDim2.new(1, -5, 0, 40)
            Btn.Parent = Page
            Btn.AutoButtonColor = false
            
            Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
            
            -- Animations
            Btn.MouseEnter:Connect(function() Tween(Btn, {BackgroundColor3 = Color3.fromRGB(45, 45, 45)}) end)
            Btn.MouseLeave:Connect(function() Tween(Btn, {BackgroundColor3 = Library.Theme.Item}) end)
            
            Btn.MouseButton1Down:Connect(function()
                Tween(Btn, {Size = UDim2.new(1, -10, 0, 38)}, TweenInfo.new(0.1)) -- Shrink
            end)
            
            Btn.MouseButton1Up:Connect(function()
                Tween(Btn, {Size = UDim2.new(1, -5, 0, 40)}, TweenInfo.new(0.1)) -- Restore
                if callback then callback() end
            end)
        end

        function Tab:AddToggle(text, default, callback)
            local Toggled = default or false
            
            local Frame = Instance.new("TextButton") -- Using TextButton container for easier clicking
            Frame.Text = ""
            Frame.BackgroundColor3 = Library.Theme.Item
            Frame.Size = UDim2.new(1, -5, 0, 40)
            Frame.AutoButtonColor = false
            Frame.Parent = Page
            Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)

            local Title = Instance.new("TextLabel", Frame)
            Title.Text = text
            Title.Font = Enum.Font.Gotham
            Title.TextSize = 14
            Title.TextColor3 = Library.Theme.Text
            Title.BackgroundTransparency = 1
            Title.Size = UDim2.new(0.7, 0, 1, 0)
            Title.Position = UDim2.fromOffset(10, 0)
            Title.TextXAlignment = Enum.TextXAlignment.Left

            local SwitchBg = Instance.new("Frame", Frame)
            SwitchBg.Size = UDim2.fromOffset(40, 20)
            SwitchBg.Position = UDim2.new(1, -50, 0.5, -10)
            SwitchBg.BackgroundColor3 = Toggled and Library.AccentColor or Color3.fromRGB(50, 50, 50)
            Instance.new("UICorner", SwitchBg).CornerRadius = UDim.new(1, 0)

            local Dot = Instance.new("Frame", SwitchBg)
            Dot.Size = UDim2.fromOffset(16, 16)
            Dot.Position = Toggled and UDim2.fromOffset(22, 2) or UDim2.fromOffset(2, 2)
            Dot.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Instance.new("UICorner", Dot).CornerRadius = UDim.new(1, 0)

            local function Update()
                Toggled = not Toggled
                local targetPos = Toggled and UDim2.fromOffset(22, 2) or UDim2.fromOffset(2, 2)
                local targetColor = Toggled and Library.AccentColor or Color3.fromRGB(50, 50, 50)
                
                Tween(Dot, {Position = targetPos})
                Tween(SwitchBg, {BackgroundColor3 = targetColor})
                if callback then callback(Toggled) end
            end

            Frame.MouseButton1Click:Connect(Update)
        end

        function Tab:AddSlider(text, min, max, default, callback)
            local Value = default or min
            local Dragging = false

            local Frame = Instance.new("Frame")
            Frame.BackgroundColor3 = Library.Theme.Item
            Frame.Size = UDim2.new(1, -5, 0, 55)
            Frame.Parent = Page
            Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)

            local Title = Instance.new("TextLabel", Frame)
            Title.Text = text
            Title.Font = Enum.Font.Gotham
            Title.TextSize = 14
            Title.TextColor3 = Library.Theme.Text
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.fromOffset(10, 5)
            Title.Size = UDim2.new(1, -20, 0, 20)
            Title.TextXAlignment = Enum.TextXAlignment.Left

            local ValueLabel = Instance.new("TextLabel", Frame)
            ValueLabel.Text = tostring(Value)
            ValueLabel.Font = Enum.Font.Gotham
            ValueLabel.TextSize = 14
            ValueLabel.TextColor3 = Library.Theme.TextDim
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.Position = UDim2.fromOffset(10, 5)
            ValueLabel.Size = UDim2.new(1, -20, 0, 20)
            ValueLabel.TextXAlignment = Enum.TextXAlignment.Right

            local SliderBar = Instance.new("TextButton", Frame) -- Clickable area
            SliderBar.Text = ""
            SliderBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            SliderBar.Size = UDim2.new(1, -20, 0, 6)
            SliderBar.Position = UDim2.fromOffset(10, 35)
            SliderBar.AutoButtonColor = false
            Instance.new("UICorner", SliderBar).CornerRadius = UDim.new(1, 0)

            local Fill = Instance.new("Frame", SliderBar)
            Fill.BackgroundColor3 = Library.AccentColor
            Fill.Size = UDim2.new((Value - min) / (max - min), 0, 1, 0)
            Instance.new("UICorner", Fill).CornerRadius = UDim.new(1, 0)

            local function Update(input)
                local SizeX = math.clamp((input.Position.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1)
                local NewValue = math.floor(min + ((max - min) * SizeX))
                
                Tween(Fill, {Size = UDim2.new(SizeX, 0, 1, 0)}, TweenInfo.new(0.05))
                ValueLabel.Text = tostring(NewValue)
                if callback then callback(NewValue) end
            end

            SliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = true
                    Update(input)
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    Update(input)
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then Dragging = false end
            end)
        end

        return Tab
    end
    
    return Window
end

-- Example Usage (Example)
-- local win = Library:CreateWindow({Title = "Dino Hub v2"})
-- local tab = win:CreateTab("Main")
-- tab:AddButton("Kill All", function() print("Killed") end)
-- tab:AddToggle("Auto Farm", false, function(v) print("Auto Farm:", v) end)
-- tab:AddSlider("WalkSpeed", 16, 200, 16, function(v) game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = v end)

return Library
